<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CDP ê°œë°œì§êµ° ì…€í”„ ì²´í¬ë¦¬ìŠ¤íŠ¸</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            text-align: center;
        }

        .header h1 {
            color: #5a67d8;
            font-size: 2.5em;
            margin-bottom: 15px;
            font-weight: 700;
        }

        .header p {
            color: #666;
            font-size: 1.1em;
            line-height: 1.8;
        }

        .card {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-bottom: 25px;
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-2px);
        }

        .section-title {
            color: #5a67d8;
            font-size: 1.8em;
            margin-bottom: 20px;
            font-weight: 600;
            border-bottom: 3px solid #5a67d8;
            padding-bottom: 10px;
        }

        .user-info {
            margin-bottom: 30px;
        }

        .user-info input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1em;
            margin-bottom: 15px;
        }

        .user-info input:focus {
            outline: none;
            border-color: #5a67d8;
        }

        .job-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .job-option {
            padding: 20px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            background: #f8fafc;
        }

        .job-option:hover {
            border-color: #5a67d8;
            background: #edf2f7;
        }

        .job-option.selected {
            border-color: #5a67d8;
            background: #5a67d8;
            color: white;
        }

        .section-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            font-size: 1.3em;
            font-weight: 600;
            margin-bottom: 20px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .section-header.backend {
            background: linear-gradient(135deg, #4299e1 0%, #3182ce 100%);
        }

        .section-header.frontend {
            background: linear-gradient(135deg, #38b2ac 0%, #319795 100%);
        }

        .section-header.common {
            background: linear-gradient(135deg, #ed8936 0%, #dd6b20 100%);
        }

        .question-card {
            margin-bottom: 25px;
            padding: 25px;
            border-left: 5px solid #5a67d8;
            background: #f8fafc;
            border-radius: 8px;
        }

        .question-title {
            font-size: 1.2em;
            font-weight: 600;
            margin-bottom: 15px;
            color: #2d3748;
        }

        .score-options {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }

        .score-option {
            padding: 15px 10px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
        }

        .score-option:hover {
            border-color: #5a67d8;
            background: #edf2f7;
        }

        .score-option.selected {
            border-color: #5a67d8;
            background: #5a67d8;
            color: white;
        }

        .score-label {
            font-weight: bold;
            font-size: 1.2em;
            margin-bottom: 5px;
        }

        .score-desc {
            font-size: 0.9em;
            line-height: 1.4;
        }

        .experience-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1em;
            resize: vertical;
            min-height: 100px;
            margin-top: 10px;
        }

        .experience-input:focus {
            outline: none;
            border-color: #5a67d8;
        }

        .experience-input.error {
            border-color: #e53e3e;
            background-color: #fed7d7;
        }

        .progress-bar-container {
            background: #e2e8f0;
            border-radius: 10px;
            height: 8px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .progress-bar {
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            height: 100%;
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        .page-info {
            text-align: center;
            margin-bottom: 20px;
            color: #666;
            font-size: 1.1em;
        }

        .navigation-buttons {
            display: flex;
            justify-content: space-between;
            gap: 15px;
            margin-top: 30px;
        }

        .nav-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            flex: 1;
        }

        .nav-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }

        .nav-btn:disabled {
            background: #cbd5e0;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .nav-btn.secondary {
            background: #e2e8f0;
            color: #4a5568;
        }

        .nav-btn.secondary:hover:not(:disabled) {
            background: #cbd5e0;
        }

        .results {
            display: none;
        }

        .summary-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 20px;
        }

        .summary-value {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .summary-label {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .comparison-card {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .comparison-item {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .comparison-item h4 {
            color: #5a67d8;
            margin-bottom: 10px;
        }

        .comparison-value {
            font-size: 2em;
            font-weight: bold;
            color: #2d3748;
        }

        .skill-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            margin-bottom: 10px;
            background: #f8fafc;
            border-radius: 8px;
            border-left: 5px solid #5a67d8;
        }

        .skill-name {
            font-weight: 600;
        }

        .skill-score {
            font-size: 1.2em;
            font-weight: bold;
            color: #5a67d8;
        }

        .recommendations {
            background: #fff5f5;
            border: 2px solid #fed7d7;
            border-radius: 10px;
            padding: 25px;
            margin-top: 20px;
        }

        .recommendations h3 {
            color: #c53030;
            margin-bottom: 15px;
        }

        .recommendations ul {
            padding-left: 20px;
        }

        .recommendations li {
            margin-bottom: 10px;
            line-height: 1.6;
        }

        .required-indicator {
            color: #e53e3e;
            font-weight: bold;
            margin-left: 5px;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #5a67d8;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .share-section {
            background: #f0f8ff;
            border: 2px solid #5a67d8;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            text-align: center;
        }

        .share-section h3 {
            color: #5a67d8;
            margin-bottom: 15px;
        }

        .share-url {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 5px;
            padding: 10px;
            margin: 10px 0;
            font-family: monospace;
            word-break: break-all;
        }

        @media (max-width: 768px) {
            .score-options {
                grid-template-columns: 1fr;
            }
            
            .job-options {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2em;
            }

            .navigation-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>CDP ê°œë°œì§êµ° ì…€í”„ ì²´í¬ë¦¬ìŠ¤íŠ¸</h1>
            <p>ë³¸ ì²´í¬ë¦¬ìŠ¤íŠ¸ëŠ” ì§êµ°ë³„ ê°–ì¶”ì–´ì•¼ í•  ì£¼ìš” ìŠ¤í‚¬ì„ ìŠ¤ìŠ¤ë¡œ ì ê²€í•  ìˆ˜ ìˆëŠ” ë¬¸í•­ìœ¼ë¡œ êµ¬ì„±ë˜ì–´ ìˆìŠµë‹ˆë‹¤.<br>
            ì‘ë‹µê²°ê³¼ëŠ” ì‘ë‹µì ë³¸ì¸ê³¼ ì§ì±…ìì—ê²Œë§Œ ê³µìœ ë˜ë©°, í–¥í›„ ëª©í‘œìˆ˜ë¦½ê³¼ êµìœ¡ì œë„ ì„¤ê³„ ì‹œ ì°¸ê³  ìë£Œë¡œ í™œìš©ë©ë‹ˆë‹¤.</p>
        </div>

        <!-- ë¡œë”© í™”ë©´ -->
        <div id="loading" class="loading">
            <div class="card">
                <div class="loading-spinner"></div>
                <p>ê²°ê³¼ë¥¼ ë¶„ì„í•˜ê³  ì €ì¥í•˜ëŠ” ì¤‘ì…ë‹ˆë‹¤...</p>
            </div>
        </div>

        <div id="job-selection" class="card">
            <div class="section-title">ì‚¬ìš©ì ì •ë³´ ë° ì§ë¬´ ì„ íƒ</div>
            
            <div class="user-info">
                <input type="text" id="user-name" placeholder="ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš” (í•„ìˆ˜)" maxlength="20">
                <input type="text" id="user-department" placeholder="ë¶€ì„œëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš” (ì„ íƒ)" maxlength="30">
                <input type="email" id="user-email" placeholder="ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš” (ì„ íƒ)" maxlength="50">
            </div>
            
            <p style="margin-bottom: 20px; color: #666;">ë³¸ì¸ì˜ ì§ë¬´ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”. (ì´ì „ ê²½í—˜ì´ë‚˜ ì•ìœ¼ë¡œì˜ ì„±ì¥ ê´€ì ì—ì„œ í™•ì¸í•˜ê³  ì‹¶ì€ ì§ë¬´ë¥¼ ì„ íƒí•´ë„ ë¬´ë°©í•©ë‹ˆë‹¤.)</p>
            <div class="job-options">
                <div class="job-option" data-job="fullstack">
                    <div style="font-weight: bold; margin-bottom: 10px;">í’€ìŠ¤íƒ ê°œë°œì</div>
                    <div style="font-size: 0.9em;">ë°±ì—”ë“œ + í”„ë¡ íŠ¸ì—”ë“œ + ì§ë¬´ê³µí†µ<br>(ì´ 13ë¬¸í•­)</div>
                </div>
                <div class="job-option" data-job="backend">
                    <div style="font-weight: bold; margin-bottom: 10px;">ë°±ì—”ë“œ ê°œë°œì</div>
                    <div style="font-size: 0.9em;">ë°±ì—”ë“œ + ì§ë¬´ê³µí†µ<br>(ì´ 8ë¬¸í•­)</div>
                </div>
                <div class="job-option" data-job="frontend">
                    <div style="font-weight: bold; margin-bottom: 10px;">í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œì</div>
                    <div style="font-size: 0.9em;">í”„ë¡ íŠ¸ì—”ë“œ + ì§ë¬´ê³µí†µ<br>(ì´ 8ë¬¸í•­)</div>
                </div>
            </div>
            <div class="navigation-buttons">
                <button type="button" class="nav-btn" id="start-btn" disabled onclick="startAssessment()">
                    ì‹œì‘í•˜ê¸°
                </button>
            </div>
        </div>

        <div id="assessment-form" style="display: none;">
            <div class="card">
                <div class="progress-bar-container">
                    <div class="progress-bar" id="progress-bar"></div>
                </div>
                <div class="page-info" id="page-info"></div>
                
                <div id="questions-container"></div>

                <div class="navigation-buttons">
                    <button type="button" class="nav-btn secondary" id="prev-btn" onclick="previousPage()" disabled>
                        ì´ì „
                    </button>
                    <button type="button" class="nav-btn" id="next-btn" onclick="nextPage()">
                        ë‹¤ìŒ
                    </button>
                </div>
            </div>
        </div>

        <div id="results" class="results">
            <div class="card">
                <div class="section-title">ğŸ¯ ê°œì¸ë³„ ì—­ëŸ‰ ë¶„ì„ ê²°ê³¼</div>
                <div id="results-content"></div>
                
                <div class="share-section">
                    <h3>ğŸ“ ê²°ê³¼ ê³µìœ </h3>
                    <p>ì•„ë˜ ë§í¬ë¥¼ í†µí•´ ê²°ê³¼ë¥¼ ë‹¤ì‹œ í™•ì¸í•˜ê±°ë‚˜ ê³µìœ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                    <div class="share-url" id="share-url"></div>
                    <button type="button" class="nav-btn" onclick="copyShareUrl()" style="margin-top: 10px; max-width: 200px;">
                        ë§í¬ ë³µì‚¬
                    </button>
                </div>
                
                <button type="button" class="nav-btn" onclick="restart()" style="margin-top: 30px;">
                    ìƒˆë¡œìš´ í‰ê°€ ì‹œì‘í•˜ê¸°
                </button>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

    <script>
        // Firebase ì„¤ì • (ì‹¤ì œ í”„ë¡œì íŠ¸ì—ì„œëŠ” í™˜ê²½ë³€ìˆ˜ ì‚¬ìš©)
        const firebaseConfig = {
            apiKey: "AIzaSyDl937FR878C_DQ8bqGqf3SkanOcFUaK-o",
            authDomain: "cdp-sorry927.firebaseapp.com",
            databaseURL: "https://cdp-sorry927-default-rtdb.firebaseio.com",
            projectId: "cdp-sorry927",
            storageBucket: "cdp-sorry927.firebasestorage.app",
            messagingSenderId: "433401427684",
            appId: "1:433401427684:web:d81ccb9549a0651b101ef1"
        };

        // Firebase ì´ˆê¸°í™”
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // ë¬¸í•­ ë°ì´í„°
        const questionData = {
            backend: [
                {
                    id: 'backend1',
                    title: 'Java, Python, Golang, TypeScript, JavaScript ì¤‘ ìµœì†Œ 2ê°œ ì´ìƒì˜ ì–¸ì–´ë¥¼ ëŠ¥ìˆ™í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.',
                    category: 'í”„ë¡œê·¸ë˜ë° ì–¸ì–´',
                    section: 'ë°±ì—”ë“œ ê°œë°œì',
                    scores: [
                        'ì–¸ì–´ì˜ ê¸°ë³¸ì ì¸ ë¬¸ë²•ê³¼ ê°œë…ì„ ì˜ ì•Œì§€ ëª»í•¨',
                        'ìµœì†Œ 1ê°œ ì–¸ì–´ì˜ ê¸°ë³¸ ë¬¸ë²•ì„ ì´í•´',
                        '2ê°œ ì´ìƒì˜ ì–¸ì–´ë¥¼ ì‹¤ë¬´ì—ì„œ ì‚¬ìš©í•œ ê²½í—˜',
                        '2ê°œ ì´ìƒì˜ ì–¸ì–´ë¥¼ ê³ ê¸‰ ìˆ˜ì¤€ìœ¼ë¡œ í™œìš©',
                        '2ê°œ ì´ìƒì˜ ì–¸ì–´ì— ëŒ€í•œ ì „ë¬¸ì„±ì„ ê°–ì¶”ê³  ê¸°ìˆ ì  ë¦¬ë” ì—­í• '
                    ]
                },
                {
                    id: 'backend2',
                    title: 'Spring Boot, Next.jsì™€ ê°™ì€ í”„ë ˆì„ì›Œí¬ë¥¼ ë‹¤ë£¬ ê²½í—˜ì´ ìˆë‹¤.',
                    category: 'í”„ë ˆì„ì›Œí¬',
                    section: 'ë°±ì—”ë“œ ê°œë°œì',
                    scores: [
                        'í”„ë ˆì„ì›Œí¬ë¥¼ ì‚¬ìš©í•œ ê²½í—˜ì´ ì—†ìŒ',
                        'í”„ë ˆì„ì›Œí¬ì˜ ê°œë…ì€ ì•Œê³  ìˆì§€ë§Œ ì‚¬ìš© ê²½í—˜ì´ ê±°ì˜ ì—†ìŒ',
                        'ê°„ë‹¨í•œ í”„ë¡œì íŠ¸ë‚˜ ê¸°ëŠ¥ ê°œë°œ ê²½í—˜',
                        'ì‹¤ë¬´ í”„ë¡œì íŠ¸ì—ì„œ ì£¼ìš” ê¸°ëŠ¥ ê°œë°œ ê²½í—˜',
                        'ëŒ€ê·œëª¨ ì‹œìŠ¤í…œ ì„¤ê³„ ë° ê°œë°œ, ê³ ê¸‰ ê¸°ëŠ¥ í™œìš© ê²½í—˜'
                    ]
                },
                {
                    id: 'backend3',
                    title: 'í”„ë ˆì„ì›Œí¬ì˜ ê¸°ë³¸ ë™ì‘ ì›ë¦¬ë¥¼ ì´í•´í•˜ê³ , ìµœì í™”ëœ ê°œë°œ í™˜ê²½ì„ êµ¬ì¶•í•œ ê²½í—˜ì´ ìˆë‹¤.',
                    category: 'ê°œë°œí™˜ê²½',
                    section: 'ë°±ì—”ë“œ ê°œë°œì',
                    scores: [
                        'í”„ë ˆì„ì›Œí¬ì˜ ê¸°ë³¸ ë™ì‘ ì›ë¦¬ë¥¼ ì´í•´í•˜ì§€ ëª»í•¨',
                        'ê¸°ë³¸ ë™ì‘ ì›ë¦¬ë¥¼ ì¼ë¶€ ì´í•´í•˜ë‚˜ í™˜ê²½ êµ¬ì¶• ê²½í—˜ ë¶€ì¡±',
                        'ë™ì‘ ì›ë¦¬ë¥¼ ê¸°ë³¸ì ìœ¼ë¡œ ì´í•´í•˜ê³  ê°œë°œ í™˜ê²½ ì„¤ì • ê²½í—˜',
                        'ì—¬ëŸ¬ í”„ë¡œì íŠ¸ì—ì„œ ìµœì í™”ëœ ê°œë°œ í™˜ê²½ êµ¬ì¶• ê²½í—˜',
                        'ë™ì‘ ì›ë¦¬ë¥¼ ê¹Šì´ ì´í•´í•˜ê³  ê³ ê¸‰ ì„¤ì • ë° ë¼ì´ë¸ŒëŸ¬ë¦¬ í™œìš©'
                    ]
                },
                {
                    id: 'backend4',
                    title: 'RESTful API ì„¤ê³„ ë° ê°œë°œ ê²½í—˜ì´ ìˆë‹¤.',
                    category: 'API ì„¤ê³„',
                    section: 'ë°±ì—”ë“œ ê°œë°œì',
                    scores: [
                        'RESTful API ì„¤ê³„ ë° ê°œë°œ ê²½í—˜ì´ ì—†ìŒ',
                        'ê°„ë‹¨í•œ API ì„¤ê³„ ë° CRUD ê¸°ëŠ¥ êµ¬í˜„ ê°€ëŠ¥',
                        'RESTful API ì„¤ê³„í•˜ê³  ì¸ì¦, ê¶Œí•œ, ìƒíƒœ ì½”ë“œ í™œìš©',
                        'ê³ ê¸‰ ê¸°ëŠ¥ì„ í†µí•©í•œ íš¨ìœ¨ì ì´ê³  í™•ì¥ì„± ìˆëŠ” API ì„¤ê³„',
                        'ëŒ€ê·œëª¨ ì‹œìŠ¤í…œì—ì„œ API ì„¤ê³„ ì£¼ë„ ë° ì¡°ì§ ë‚´ í‘œì¤€í™”'
                    ]
                },
                {
                    id: 'backend5',
                    title: 'ì™¸ë¶€ ë° ë‚´ë¶€ ì‹œìŠ¤í…œê³¼ì˜ í†µí•©ì—°ë™ì„ ìœ„í•œ API ì„¤ê³„ ë° êµ¬í˜„ ê²½í—˜ì´ ìˆë‹¤.',
                    category: 'ì‹œìŠ¤í…œ ì—°ë™',
                    section: 'ë°±ì—”ë“œ ê°œë°œì',
                    scores: [
                        'API ì—°ë™ ê²½í—˜ì´ ì—†ê³  ê¸°ë³¸ ê°œë…ì„ ì˜ ì´í•´í•˜ì§€ ëª»í•¨',
                        'ë‹¨ìˆœí•œ ì™¸ë¶€ API í˜¸ì¶œ ë° ê¸°ë³¸ì ì¸ ì¸ì¦ ë°©ì‹ ì‚¬ìš©',
                        'ì™¸ë¶€ ë° ë‚´ë¶€ ì‹œìŠ¤í…œ ê°„ì˜ API ì„¤ê³„ ë° êµ¬í˜„ ê²½í—˜',
                        'ëŒ€ê·œëª¨ ì‹œìŠ¤í…œì˜ í™•ì¥ì„±, ì„±ëŠ¥ ìµœì í™”ë¥¼ ê³ ë ¤í•œ API ì„¤ê³„',
                        'ëŒ€ê·œëª¨ ë¶„ì‚° ì‹œìŠ¤í…œì—ì„œ ë³µì¡í•œ API í†µí•© ì—°ë™ ì£¼ë„'
                    ]
                }
            ],
            frontend: [
                {
                    id: 'frontend1',
                    title: 'JavaScript ì‚¬ìš©ì— ëŠ¥ìˆ™í•˜ë‹¤.',
                    category: 'JavaScript',
                    section: 'í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œì',
                    scores: [
                        'JavaScript ê¸°ë³¸ ë¬¸ë²•ê³¼ ì‚¬ìš©ë²•ì— ìµìˆ™í•˜ì§€ ì•ŠìŒ',
                        'ê¸°ë³¸ì ì¸ ë¬¸ë²•ê³¼ ë¡œì§ì€ ì‘ì„± ê°€ëŠ¥í•˜ë‚˜ ë³µì¡í•œ ì²˜ë¦¬ëŠ” ë¯¸ìˆ™',
                        'ì¼ë°˜ì ì¸ ê°œë°œ ê³¼ì œë¥¼ í•´ê²°í•˜ê³  ES6+ ë¬¸ë²• í™œìš©',
                        'JavaScriptì˜ ë™ì‘ ì›ë¦¬ë¥¼ ì´í•´í•˜ê³  ë³µì¡í•œ ë¬¸ì œ í•´ê²°',
                        'JavaScript ì „ë¬¸ê°€ë¡œì„œ ìµœì í™”, ë©˜í† ë§, ì½”ë“œ í’ˆì§ˆ í–¥ìƒ'
                    ]
                },
                {
                    id: 'frontend2',
                    title: 'TypeScriptë¥¼ í™œìš©í•œ í”„ë¡œì íŠ¸ ê²½í—˜ì´ ìˆë‹¤.',
                    category: 'TypeScript',
                    section: 'í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œì',
                    scores: [
                        'TypeScript ì‚¬ìš© ê²½í—˜ì´ ê±°ì˜ ì—†ê³  ê°œë… ì´í•´ ë¶€ì¡±',
                        'TypeScriptì˜ ê¸°ë³¸ ë¬¸ë²•ì„ ì´í•´í•˜ê³  ì œí•œì ìœ¼ë¡œ ì‚¬ìš©',
                        'ì‹¤ë¬´ í”„ë¡œì íŠ¸ì—ì„œ TypeScript ì‚¬ìš©í•˜ê³  ê¸°ë³¸ íƒ€ì… ì‹œìŠ¤í…œ í™œìš©',
                        'TypeScriptë¥¼ ëŒ€ê·œëª¨ í”„ë¡œì íŠ¸ì— ì ìš©í•˜ê³  ê³ ê¸‰ íƒ€ì… í™œìš©',
                        'TypeScript ì „ë¬¸ê°€ë¡œ í”„ë¡œì íŠ¸ ì„¤ê³„, êµìœ¡, ë©˜í† ë§, ì˜¤í”ˆì†ŒìŠ¤ ê¸°ì—¬'
                    ]
                },
                {
                    id: 'frontend3',
                    title: 'React í”„ë ˆì„ì›Œí¬ ê²½í—˜ì´ ìˆë‹¤.',
                    category: 'React',
                    section: 'í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œì',
                    scores: [
                        'React í”„ë ˆì„ì›Œí¬ì˜ ê°œë…ì„ ì•Œì§€ ëª»í•˜ê³  ì‹¤ë¬´ ê²½í—˜ ì—†ìŒ',
                        'Reactì˜ ê¸°ë³¸ ê°œë…ì„ ì´í•´í•˜ê³  ê°„ë‹¨í•œ ì»´í¬ë„ŒíŠ¸ ì‘ì„±',
                        'Reactë¡œ ì»´í¬ë„ŒíŠ¸ ì„¤ê³„í•˜ê³  ìƒíƒœ ê´€ë¦¬, ë¼ìš°íŒ… ê²½í—˜',
                        'Reactë¡œ ë³µì¡í•œ ìƒíƒœ ê´€ë¦¬ ë° ìµœì í™”, ë‹¤ì–‘í•œ ê¸°ëŠ¥ êµ¬í˜„',
                        'React ê³ ê¸‰ ê¸°ëŠ¥ ì ìš©ê³¼ ë‹¤ì–‘í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì—°ë™ ê²½í—˜'
                    ]
                },
                {
                    id: 'frontend4',
                    title: 'HTML5ì˜ ì›¹ í‘œì¤€ ë° ì‹œë§¨í‹± íƒœê·¸ë¥¼ ì´í•´í•˜ê³  ìˆë‹¤.',
                    category: 'HTML5',
                    section: 'í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œì',
                    scores: [
                        'HTML5 ê¸°ë³¸ ë¬¸ë²•ê³¼ ì›¹ í‘œì¤€, ì‹œë§¨í‹± íƒœê·¸ ì—­í• ì„ ì´í•´í•˜ì§€ ëª»í•¨',
                        'HTML5ì˜ ê¸°ë³¸ íƒœê·¸ ì‚¬ìš©í•˜ë‚˜ ì‹œë§¨í‹± íƒœê·¸ í™œìš©ì´ ë¯¸ìˆ™',
                        'ì›¹ í‘œì¤€ê³¼ ì‹œë§¨í‹± íƒœê·¸ë¥¼ ì‹¤ë¬´ì—ì„œ í™œìš©í•˜ê³  ê¸°ë³¸ SEO ì ìš©',
                        'ì ‘ê·¼ì„±ê³¼ SEOë¥¼ ê³ ë ¤í•œ HTML5 ì„¤ê³„ì™€ í¬ë¡œìŠ¤ ë¸Œë¼ìš°ì§• í•´ê²°',
                        'HTML5 í‘œì¤€ê³¼ ì‹œë§¨í‹± íƒœê·¸ ì„¤ê³„ë¥¼ ì„ ë„í•˜ê³  í”„ë¡œì íŠ¸ í‘œì¤€í™”'
                    ]
                },
                {
                    id: 'frontend5',
                    title: 'CSS3ì™€ ê´€ë ¨ëœ ë ˆì´ì•„ì›ƒ, ì• ë‹ˆë©”ì´ì…˜, ê·¸ë¦¬ë“œ ì‹œìŠ¤í…œì„ ì´í•´í•˜ê³  ìˆë‹¤.',
                    category: 'CSS3',
                    section: 'í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œì',
                    scores: [
                        'CSSì˜ ê¸°ë³¸ ê°œë…ì— ìµìˆ™í•˜ì§€ ì•Šê³  ë ˆì´ì•„ì›ƒ ì„¤ê³„ì— ì–´ë ¤ì›€',
                        'ê¸°ë³¸ ë ˆì´ì•„ì›ƒê³¼ ê°„ë‹¨í•œ ì• ë‹ˆë©”ì´ì…˜ êµ¬í˜„ ê°€ëŠ¥í•˜ë‚˜ ê³ ê¸‰ ê¸°ëŠ¥ì€ ë¯¸ìˆ™',
                        'Flexboxì™€ CSS Grid í™œìš©í•˜ê³  íŠ¸ëœì§€ì…˜ê³¼ ì• ë‹ˆë©”ì´ì…˜ìœ¼ë¡œ UI ê°œì„ ',
                        'ë³µì¡í•œ ë ˆì´ì•„ì›ƒ ë° ì• ë‹ˆë©”ì´ì…˜ ì„¤ê³„ì™€ ë°˜ì‘í˜• ë””ìì¸ì— ëŠ¥ìˆ™',
                        'CSS3 ì „ë¬¸ê°€ë¡œ ê³ ê¸‰ ë ˆì´ì•„ì›ƒ ì„¤ê³„, ì„±ëŠ¥ ìµœì í™”, íŒ€ í‘œì¤€í™”'
                    ]
                }
            ],
            common: [
                {
                    id: 'common1',
                    title: 'Gitì„ ì‚¬ìš©í•´ ì½”ë“œ ë²„ì „ ê´€ë¦¬ë¥¼ í•  ìˆ˜ ìˆë‹¤.',
                    category: 'ë²„ì „ ê´€ë¦¬',
                    section: 'ì§ë¬´ ê³µí†µ',
                    scores: [
                        'Gitì˜ ê¸°ë³¸ ê°œë…ì„ ì´í•´í•˜ë‚˜ í”„ë¡œì íŠ¸ì— ì‚¬ìš©í•œ ê²½í—˜ ì—†ìŒ',
                        'ê°œì¸ ì‹¤ë¬´ì—ì„œ Gitì„ í™œìš©í•˜ê³  ê°„ë‹¨í•œ ì¶©ëŒ í•´ê²° ê²½í—˜',
                        'ì‹¤ë¬´ì—ì„œ íŒ€ì›ë“¤ê³¼ í˜‘ì—…í•˜ê³  ë¸Œëœì¹˜ ì „ëµ ë° PR/MR ì‘ì—… ìˆ˜í–‰',
                        'ëŒ€ê·œëª¨ í”„ë¡œì íŠ¸ì—ì„œ Git ì›Œí¬í”Œë¡œ ì„¤ê³„ ë° ê´€ë¦¬, CI/CD í†µí•©',
                        'Git ì „ë¬¸ê°€ë¡œ ì˜¤í”ˆì†ŒìŠ¤ ê¸°ì—¬, êµìœ¡, ì¡°ì§ê³¼ ì—…ê³„ ê¸°ì—¬'
                    ]
                },
                {
                    id: 'common2',
                    title: 'ë³€í™”í•˜ëŠ” ê¸°ìˆ ì— ë¹ ë¥´ê²Œ ì ì‘í•˜ê³  í•™ìŠµí•  ìˆ˜ ìˆëŠ” ëŠ¥ë ¥ì´ ìˆë‹¤.',
                    category: 'í•™ìŠµ ëŠ¥ë ¥',
                    section: 'ì§ë¬´ ê³µí†µ',
                    scores: [
                        'ê¸°ìˆ  íŠ¸ë Œë“œì˜ í•„ìš”ì„±ì„ ì¸ì‹í•˜ë‚˜ í•™ìŠµí•˜ê±°ë‚˜ ì ìš©í•œ ê²½í—˜ ì—†ìŒ',
                        'ìƒˆë¡œìš´ ê¸°ìˆ ì„ í•™ìŠµí•˜ë‚˜ ì‹¤ë¬´ í”„ë¡œì íŠ¸ì— ì ìš©í•˜ì§€ ëª»í•¨',
                        'ìƒˆë¡œìš´ ê¸°ìˆ ì„ ë¹ ë¥´ê²Œ í•™ìŠµí•˜ê³  ì‹¤ë¬´ í”„ë¡œì íŠ¸ì— ì ìš©í•˜ì—¬ ì„±ê³¼',
                        'ëŒ€ê·œëª¨ í”„ë¡œì íŠ¸ì—ì„œ ìƒˆë¡œìš´ ê¸°ìˆ  ë„ì…í•˜ê³  íŒ€ì›ë“¤ì—ê²Œ ì „íŒŒ',
                        'ê¸°ìˆ  íŠ¸ë Œë“œë¥¼ ì„ ë„í•˜ê³  ì¡°ì§ ë° ì—…ê³„ ê¸°ì—¬, ê¸€ë¡œë²Œ ì»¤ë®¤ë‹ˆí‹° ì˜í–¥ë ¥'
                    ]
                },
                {
                    id: 'common3',
                    title: 'í´ë¦° ì½”ë“œ ì‘ì„± ì›ì¹™ì„ ì´í•´í•˜ê³  ì´ë¥¼ ì‹¤ì²œí•˜ê³  ìˆë‹¤.',
                    category: 'ì½”ë“œ í’ˆì§ˆ',
                    section: 'ì§ë¬´ ê³µí†µ',
                    scores: [
                        'í´ë¦° ì½”ë“œ ì‘ì„± ì›ì¹™ì— ëŒ€í•œ ì´í•´ì™€ ê²½í—˜ì´ ì—†ìŒ',
                        'í´ë¦° ì½”ë“œ ì›ì¹™ì˜ ê¸°ë³¸ ê°œë…ì„ ì´í•´í•˜ê³  ê°„ë‹¨í•œ ì›ì¹™ ì ìš©',
                        'í´ë¦° ì½”ë“œ ì›ì¹™ì„ ì ìš©í•˜ì—¬ ê°€ë…ì„±ê³¼ ìœ ì§€ë³´ìˆ˜ì„± í–¥ìƒ',
                        'ëŒ€ê·œëª¨ í”„ë¡œì íŠ¸ì—ì„œ í´ë¦° ì½”ë“œ ì›ì¹™ì„ ì£¼ë„ì ìœ¼ë¡œ ì‹¤ì²œ',
                        'í´ë¦° ì½”ë“œ ì‘ì„±ì˜ ì „ë¬¸ê°€ë¡œ ì¡°ì§ ë‚´ ì½”ë“œ í’ˆì§ˆ í‘œì¤€í™” ì£¼ë„'
                    ]
                }
            ]
        };

        // ì „ì—­ ë³€ìˆ˜
        let selectedJob = '';
        let responses = {};
        let allQuestions = [];
        let currentPage = 0;
        let userInfo = {};
        let responseId = '';
        const questionsPerPage = 4;

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            console.log('í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ');
            // URL íŒŒë¼ë¯¸í„° í™•ì¸ (ê²°ê³¼ ì¡°íšŒ)
            checkUrlParams();
            updateStartButton();
        });

        // URL íŒŒë¼ë¯¸í„°ë¡œ ê²°ê³¼ ì¡°íšŒ
        function checkUrlParams() {
            const urlParams = new URLSearchParams(window.location.search);
            const resultId = urlParams.get('result');
            
            if (resultId) {
                loadPreviousResult(resultId);
            }
        }

        // ì´ì „ ê²°ê³¼ ë¶ˆëŸ¬ì˜¤ê¸°
        async function loadPreviousResult(resultId) {
            try {
                const snapshot = await database.ref('responses/' + resultId).once('value');
                const data = snapshot.val();
                
                if (data) {
                    document.getElementById('job-selection').style.display = 'none';
                    document.getElementById('assessment-form').style.display = 'none';
                    document.getElementById('results').style.display = 'block';
                    
                    // ì „ì—­ ë°ì´í„°ì—ì„œ í‰ê·  ê³„ì‚°í•˜ì—¬ ê²°ê³¼ í‘œì‹œ
                    const analysis = await analyzeWithComparison(data.responses, data.userInfo.job);
                    displayResults(analysis, data.userInfo, resultId);
                }
            } catch (error) {
                console.error('ê²°ê³¼ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:', error);
                alert('ê²°ê³¼ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            }
        }

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        document.addEventListener('click', function(e) {
            // ì§ë¬´ ì„ íƒ ì´ë²¤íŠ¸
            const jobOption = e.target.closest('.job-option');
            if (jobOption) {
                selectedJob = jobOption.getAttribute('data-job');
                console.log('ì„ íƒëœ ì§ë¬´:', selectedJob);
                
                // UI ì—…ë°ì´íŠ¸
                document.querySelectorAll('.job-option').forEach(option => {
                    option.classList.remove('selected');
                });
                jobOption.classList.add('selected');
                
                updateStartButton();
                return;
            }
            
            // ì ìˆ˜ ì„ íƒ ì´ë²¤íŠ¸
            const scoreOption = e.target.closest('.score-option');
            if (scoreOption) {
                const questionId = scoreOption.getAttribute('data-question');
                const score = parseInt(scoreOption.getAttribute('data-score'));
                
                // ê°™ì€ ë¬¸í•­ì˜ ë‹¤ë¥¸ ì„ íƒ í•´ì œ
                document.querySelectorAll(`[data-question="${questionId}"].score-option`).forEach(opt => {
                    opt.classList.remove('selected');
                    opt.style.borderColor = '#e2e8f0';
                });
                
                // í˜„ì¬ ì„ íƒ í‘œì‹œ
                scoreOption.classList.add('selected');
                
                // ì‘ë‹µ ì €ì¥
                if (!responses[questionId]) {
                    responses[questionId] = {};
                }
                responses[questionId].score = score;
                
                // ì¹´í…Œê³ ë¦¬ ì •ë³´ ì°¾ê¸°
                const questionInfo = allQuestions.find(q => q.id === questionId);
                if (questionInfo) {
                    responses[questionId].category = questionInfo.category;
                }
                
                // ì—ëŸ¬ ìŠ¤íƒ€ì¼ ì œê±°
                const experienceInput = document.querySelector(`[data-question="${questionId}"].experience-input`);
                if (experienceInput) {
                    experienceInput.classList.remove('error');
                }
            }
        });

        // ê²½í—˜ ì…ë ¥ ì´ë²¤íŠ¸
        document.addEventListener('input', function(e) {
            if (e.target.classList.contains('experience-input')) {
                const questionId = e.target.getAttribute('data-question');
                if (!responses[questionId]) {
                    responses[questionId] = {};
                }
                responses[questionId].experience = e.target.value;
                
                // ì—ëŸ¬ ìŠ¤íƒ€ì¼ ì œê±°
                if (e.target.value.trim() !== '') {
                    e.target.classList.remove('error');
                }
            }
        });

        // í•¨ìˆ˜ ì •ì˜
        function updateStartButton() {
            const startBtn = document.getElementById('start-btn');
            const userName = document.getElementById('user-name').value.trim();
            const isJobSelected = selectedJob !== '';
            const isValidInput = userName !== '' && isJobSelected;
            
            console.log('ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸:', selectedJob, userName, isValidInput);
            
            startBtn.disabled = !isValidInput;
        }

        // ì‚¬ìš©ì ì •ë³´ ì…ë ¥ ê°ì§€
        document.getElementById('user-name').addEventListener('input', updateStartButton);

        function startAssessment() {
            console.log('í‰ê°€ ì‹œì‘, ì„ íƒëœ ì§ë¬´:', selectedJob);
            
            const userName = document.getElementById('user-name').value.trim();
            const userDepartment = document.getElementById('user-department').value.trim();
            const userEmail = document.getElementById('user-email').value.trim();
            
            if (!selectedJob || !userName) {
                alert('ì´ë¦„ì„ ì…ë ¥í•˜ê³  ì§ë¬´ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // ì‚¬ìš©ì ì •ë³´ ì €ì¥
            userInfo = {
                name: userName,
                department: userDepartment,
                email: userEmail,
                job: selectedJob,
                startTime: new Date().toISOString()
            };
            
            // ë¬¸í•­ ì„¤ì •
            if (selectedJob === 'fullstack') {
                allQuestions = [...questionData.backend, ...questionData.frontend, ...questionData.common];
            } else if (selectedJob === 'backend') {
                allQuestions = [...questionData.backend, ...questionData.common];
            } else if (selectedJob === 'frontend') {
                allQuestions = [...questionData.frontend, ...questionData.common];
            }
            
            console.log('ì„¤ì •ëœ ë¬¸í•­ ìˆ˜:', allQuestions.length);
            
            // ì‘ë‹µ ì´ˆê¸°í™”
            responses = {};
            currentPage = 0;
            
            // í™”ë©´ ì „í™˜
            document.getElementById('job-selection').style.display = 'none';
            document.getElementById('assessment-form').style.display = 'block';
            
            // ì²« í˜ì´ì§€ í‘œì‹œ
            displayCurrentPage();
        }

        function displayCurrentPage() {
            const container = document.getElementById('questions-container');
            container.innerHTML = '';
            
            const startIndex = currentPage * questionsPerPage;
            const endIndex = Math.min(startIndex + questionsPerPage, allQuestions.length);
            const currentQuestions = allQuestions.slice(startIndex, endIndex);
            
            // í˜„ì¬ í˜ì´ì§€ì˜ ë¬¸í•­ë“¤ì„ ì„¹ì…˜ë³„ë¡œ ê·¸ë£¹í™”
            const sectionGroups = {};
            
            currentQuestions.forEach((question, index) => {
                const section = question.section;
                if (!sectionGroups[section]) {
                    sectionGroups[section] = [];
                }
                sectionGroups[section].push({
                    question,
                    questionNumber: startIndex + index + 1
                });
            });
            
            // ì„¹ì…˜ ìˆœì„œ ì •ì˜
            const sectionOrder = ['ë°±ì—”ë“œ ê°œë°œì', 'í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œì', 'ì§ë¬´ ê³µí†µ'];
            
            // ì •ì˜ëœ ìˆœì„œëŒ€ë¡œ ì„¹ì…˜ í‘œì‹œ
            sectionOrder.forEach(section => {
                if (sectionGroups[section] && sectionGroups[section].length > 0) {
                    // ì„¹ì…˜ë³„ ìŠ¤íƒ€ì¼ í´ë˜ìŠ¤ ê²°ì •
                    let sectionClass = '';
                    if (section === 'ë°±ì—”ë“œ ê°œë°œì') sectionClass = 'backend';
                    else if (section === 'í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œì') sectionClass = 'frontend';
                    else if (section === 'ì§ë¬´ ê³µí†µ') sectionClass = 'common';
                    
                    // ì„¹ì…˜ í—¤ë” ì¶”ê°€
                    const sectionHeader = document.createElement('div');
                    sectionHeader.className = `section-header ${sectionClass}`;
                    sectionHeader.textContent = section;
                    container.appendChild(sectionHeader);
                    
                    // í•´ë‹¹ ì„¹ì…˜ì˜ ë¬¸í•­ë“¤ ì¶”ê°€
                    sectionGroups[section].forEach(({ question, questionNumber }) => {
                        const questionCard = createQuestionCard(question, questionNumber);
                        container.appendChild(questionCard);
                    });
                }
            });
            
            updatePageInfo();
            updateNavigationButtons();
            updateProgressBar();
        }

        function createQuestionCard(question, questionNumber) {
            const card = document.createElement('div');
            card.className = 'question-card';
            
            // ê¸°ì¡´ ì‘ë‹µ í™•ì¸
            const existingResponse = responses[question.id];
            const selectedScore = existingResponse ? existingResponse.score : null;
            const existingExperience = existingResponse ? existingResponse.experience || '' : '';
            
            card.innerHTML = `
                <div class="question-title">
                    ${questionNumber}. ${question.title} <span class="required-indicator">*</span>
                </div>
                
                <div class="score-options">
                    ${question.scores.map((score, index) => `
                        <div class="score-option ${selectedScore === index + 1 ? 'selected' : ''}" 
                             data-score="${index + 1}" data-question="${question.id}">
                            <div class="score-label">${index + 1}ì </div>
                            <div class="score-desc">${score}</div>
                        </div>
                    `).join('')}
                </div>
                
                <div style="margin-top: 20px;">
                    <label style="font-weight: 600; color: #2d3748; margin-bottom: 10px; display: block;">
                        ${questionNumber}-1. ì„ íƒí•œ ì ìˆ˜ì— ëŒ€í•œ êµ¬ì²´ì ì¸ ê²½í—˜ì„ ì‘ì„±í•´ì£¼ì„¸ìš”. <span class="required-indicator">*</span>
                    </label>
                    <textarea class="experience-input" 
                              data-question="${question.id}" 
                              placeholder="êµ¬ì²´ì ì¸ ê²½í—˜ì´ë‚˜ í”„ë¡œì íŠ¸ ì‚¬ë¡€ë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”...">${existingExperience}</textarea>
                </div>
            `;
            
            return card;
        }

        function updatePageInfo() {
            const totalPages = Math.ceil(allQuestions.length / questionsPerPage);
            const pageInfo = document.getElementById('page-info');
            pageInfo.textContent = `${currentPage + 1} / ${totalPages} í˜ì´ì§€`;
        }

        function updateNavigationButtons() {
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');
            const totalPages = Math.ceil(allQuestions.length / questionsPerPage);
            
            prevBtn.disabled = currentPage === 0;
            
            if (currentPage === totalPages - 1) {
                nextBtn.textContent = 'ê²°ê³¼ ë¶„ì„í•˜ê¸°';
                nextBtn.onclick = generateResults;
            } else {
                nextBtn.textContent = 'ë‹¤ìŒ';
                nextBtn.onclick = nextPage;
            }
        }

        function updateProgressBar() {
            const progress = ((currentPage + 1) / Math.ceil(allQuestions.length / questionsPerPage)) * 100;
            document.getElementById('progress-bar').style.width = progress + '%';
        }

        function validateCurrentPage() {
            const startIndex = currentPage * questionsPerPage;
            const endIndex = Math.min(startIndex + questionsPerPage, allQuestions.length);
            const currentQuestions = allQuestions.slice(startIndex, endIndex);
            
            let isValid = true;
            
            currentQuestions.forEach(question => {
                const response = responses[question.id];
                const scoreSelected = response && response.score;
                const experienceWritten = response && response.experience && response.experience.trim() !== '';
                
                if (!scoreSelected || !experienceWritten) {
                    isValid = false;
                    
                    // ì—ëŸ¬ ìŠ¤íƒ€ì¼ ì ìš©
                    if (!scoreSelected) {
                        document.querySelectorAll(`[data-question="${question.id}"].score-option`).forEach(opt => {
                            opt.style.borderColor = '#e53e3e';
                        });
                    }
                    
                    if (!experienceWritten) {
                        const experienceInput = document.querySelector(`[data-question="${question.id}"].experience-input`);
                        if (experienceInput) {
                            experienceInput.classList.add('error');
                        }
                    }
                }
            });
            
            if (!isValid) {
                alert('1~5ì  ì¤‘ í•˜ë‚˜ë¥¼ ì„ íƒí•˜ê³  ì„ íƒí•œ ì ìˆ˜ì— ëŒ€í•œ ê´€ë ¨ ê²½í—˜ì— ëŒ€í•œ ë‚´ìš©ì„ ì‘ì„±í•´ì£¼ì„¸ìš”.');
                return false;
            }
            
            return true;
        }

        function nextPage() {
            if (!validateCurrentPage()) {
                return;
            }
            
            const totalPages = Math.ceil(allQuestions.length / questionsPerPage);
            if (currentPage < totalPages - 1) {
                currentPage++;
                displayCurrentPage();
            }
        }

        function previousPage() {
            if (currentPage > 0) {
                currentPage--;
                displayCurrentPage();
            }
        }

        async function generateResults() {
            if (!validateCurrentPage()) {
                return;
            }
            
            // ë¡œë”© í™”ë©´ í‘œì‹œ
            document.getElementById('assessment-form').style.display = 'none';
            document.getElementById('loading').style.display = 'block';
            
            try {
                // Firebaseì— ì‘ë‹µ ì €ì¥
                const responseData = {
                    userInfo: userInfo,
                    responses: responses,
                    completedAt: new Date().toISOString(),
                    timestamp: firebase.database.ServerValue.TIMESTAMP
                };
                
                // ì‘ë‹µì„ Firebaseì— ì €ì¥
                const newResponseRef = await database.ref('responses').push(responseData);
                responseId = newResponseRef.key;
                
                console.log('ì‘ë‹µ ì €ì¥ ì™„ë£Œ, ID:', responseId);
                
                // ì „ì²´ ë°ì´í„°ì™€ ë¹„êµí•˜ì—¬ ë¶„ì„
                const analysis = await analyzeWithComparison(responses, selectedJob);
                
                // ê²°ê³¼ í‘œì‹œ
                displayResults(analysis, userInfo, responseId);
                
                // í™”ë©´ ì „í™˜
                document.getElementById('loading').style.display = 'none';
                document.getElementById('results').style.display = 'block';
                
            } catch (error) {
                console.error('ê²°ê³¼ ì €ì¥ ì‹¤íŒ¨:', error);
                alert('ê²°ê³¼ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                
                // ë¡œë”© í™”ë©´ ìˆ¨ê¸°ê³  í‰ê°€ í™”ë©´ìœ¼ë¡œ ë³µê·€
                document.getElementById('loading').style.display = 'none';
                document.getElementById('assessment-form').style.display = 'block';
            }
        }

        async function analyzeWithComparison(currentResponses, jobType) {
            let totalScore = 0;
            let maxScore = 0;
            const categoryScores = {};
            
            // ê°œì¸ ì ìˆ˜ ê³„ì‚°
            for (const [questionId, response] of Object.entries(currentResponses)) {
                if (response.score) {
                    totalScore += response.score;
                    maxScore += 5;
                    
                    if (!categoryScores[response.category]) {
                        categoryScores[response.category] = { total: 0, count: 0 };
                    }
                    categoryScores[response.category].total += response.score;
                    categoryScores[response.category].count += 1;
                }
            }
            
            // ê°œì¸ í‰ê·  ì ìˆ˜ ê³„ì‚° (5ì  ë§Œì  ê¸°ì¤€ìœ¼ë¡œ í™˜ì‚°)
            const personalAverage = maxScore > 0 ? (totalScore / (maxScore / 5)) : 0;
            
            // ì¡°ì§ í‰ê· ê³¼ ë¹„êµ
            let organizationAverage = null;
            let jobTypeAverage = null;
            
            try {
                // Firebaseì—ì„œ ì „ì²´ ì‘ë‹µ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
                const snapshot = await database.ref('responses').once('value');
                const allResponses = snapshot.val();
                
                if (allResponses) {
                    const responseValues = Object.values(allResponses);
                    
                    // ì „ì²´ í‰ê·  ê³„ì‚°
                    organizationAverage = calculateAverageFromResponses(responseValues);
                    
                    // ê°™ì€ ì§ë¬´ í‰ê·  ê³„ì‚°
                    const sameJobResponses = responseValues.filter(r => r.userInfo.job === jobType);
                    if (sameJobResponses.length > 1) { // ë³¸ì¸ í¬í•¨í•´ì„œ 2ëª… ì´ìƒì¼ ë•Œë§Œ
                        jobTypeAverage = calculateAverageFromResponses(sameJobResponses);
                    }
                }
            } catch (error) {
                console.error('í‰ê·  ê³„ì‚° ì‹¤íŒ¨:', error);
            }
            
            return {
                personal: {
                    totalScore,
                    maxScore,
                    averageScore: personalAverage, // 5ì  ë§Œì  ê¸°ì¤€ í‰ê·  ì ìˆ˜
                    categoryScores,
                    questionsCount: Object.keys(currentResponses).length
                },
                comparison: {
                    organizationAverage,
                    jobTypeAverage
                }
            };
        }

        function calculateAverageFromResponses(responses) {
            if (!responses || responses.length === 0) return null;
            
            let totalSum = 0;
            let totalQuestions = 0;
            const categoryTotals = {};
            const categoryCounts = {};
            
            responses.forEach(responseData => {
                if (responseData.responses) {
                    Object.values(responseData.responses).forEach(response => {
                        if (response.score && response.category) {
                            totalSum += response.score;
                            totalQuestions++;
                            
                            if (!categoryTotals[response.category]) {
                                categoryTotals[response.category] = 0;
                                categoryCounts[response.category] = 0;
                            }
                            categoryTotals[response.category] += response.score;
                            categoryCounts[response.category]++;
                        }
                    });
                }
            });
            
            if (totalQuestions === 0) return null;
            
            // 5ì  ë§Œì  ê¸°ì¤€ í‰ê·  ì ìˆ˜ ê³„ì‚°
            const overallAverage = totalSum / totalQuestions;
            
            const categoryAverages = {};
            Object.keys(categoryTotals).forEach(category => {
                categoryAverages[category] = categoryTotals[category] / categoryCounts[category];
            });
            
            return {
                overall: overallAverage, // 5ì  ë§Œì  ê¸°ì¤€ í‰ê· 
                categories: categoryAverages,
                sampleSize: responses.length
            };
        }

        function displayResults(analysis, userData, resultId) {
            const container = document.getElementById('results-content');
            
            // ê°œì¸ í‰ê·  ì ìˆ˜ (ì†Œìˆ˜ì  2ìë¦¬ê¹Œì§€)
            const personalScore = analysis.personal.averageScore.toFixed(2);
            
            let resultHTML = `
                <div class="summary-card">
                    <div class="summary-value">${personalScore}ì </div>
                    <div class="summary-label">ê°œì¸ í‰ê·  ì ìˆ˜ (5ì  ë§Œì )</div>
                </div>
            `;
            
            // ë¹„êµ ë¶„ì„ ì¹´ë“œ
            if (analysis.comparison.organizationAverage || analysis.comparison.jobTypeAverage) {
                resultHTML += `<div class="comparison-card">`;
                
                resultHTML += `
                    <div class="comparison-item">
                        <h4>ê°œì¸ ì ìˆ˜</h4>
                        <div class="comparison-value">${personalScore}ì </div>
                    </div>
                `;
                
                if (analysis.comparison.organizationAverage) {
                    const orgScore = analysis.comparison.organizationAverage.overall.toFixed(2);
                    resultHTML += `
                        <div class="comparison-item">
                            <h4>ì¡°ì§ í‰ê· </h4>
                            <div class="comparison-value">${orgScore}ì </div>
                            <small>(${analysis.comparison.organizationAverage.sampleSize}ëª… ê¸°ì¤€)</small>
                        </div>
                    `;
                }
                
                if (analysis.comparison.jobTypeAverage) {
                    const jobScore = analysis.comparison.jobTypeAverage.overall.toFixed(2);
                    resultHTML += `
                        <div class="comparison-item">
                            <h4>${userData.job} í‰ê· </h4>
                            <div class="comparison-value">${jobScore}ì </div>
                            <small>(${analysis.comparison.jobTypeAverage.sampleSize}ëª… ê¸°ì¤€)</small>
                        </div>
                    `;
                }
                
                resultHTML += `</div>`;
            }
            
            resultHTML += `<h3 style="color: #5a67d8; margin-bottom: 20px;">ğŸ“Š ì¹´í…Œê³ ë¦¬ë³„ ì—­ëŸ‰ ë¶„ì„</h3>`;
            
            for (const [category, data] of Object.entries(analysis.personal.categoryScores)) {
                const categoryAvg = (data.total / data.count).toFixed(2);
                const orgAvg = analysis.comparison.organizationAverage?.categories[category];
                const jobAvg = analysis.comparison.jobTypeAverage?.categories[category];
                
                resultHTML += `
                    <div class="skill-item">
                        <div class="skill-name">
                            ${category}
                            ${orgAvg ? `<br><small style="color: #666;">ì¡°ì§í‰ê· : ${orgAvg.toFixed(2)}ì </small>` : ''}
                            ${jobAvg ? `<br><small style="color: #666;">${userData.job}í‰ê· : ${jobAvg.toFixed(2)}ì </small>` : ''}
                        </div>
                        <div class="skill-score">${categoryAvg}ì </div>
                    </div>
                `;
            }
            
            // ê°œì„  ê¶Œì¥ì‚¬í•­ ìƒì„±
            resultHTML += generateRecommendations(analysis);
            
            container.innerHTML = resultHTML;
            
            // ê³µìœ  URL ì„¤ì •
            const shareUrl = `${window.location.origin}${window.location.pathname}?result=${resultId}`;
            document.getElementById('share-url').textContent = shareUrl;
        }

        function generateRecommendations(analysis) {
            let recommendations = [];
            const personalData = analysis.personal;
            const comparison = analysis.comparison;
            
            // ê°œì¸ í‰ê·  ì ìˆ˜ ê¸°ì¤€ ê¶Œì¥ì‚¬í•­ (5ì  ë§Œì  ê¸°ì¤€)
            const personalScore = personalData.averageScore;
            
            if (personalScore < 2.0) {
                recommendations.push('ê¸°ë³¸ì ì¸ ê°œë°œ ì—­ëŸ‰ ìŠµë“ì„ ìœ„í•œ ì²´ê³„ì ì¸ í•™ìŠµì´ í•„ìš”í•©ë‹ˆë‹¤.');
                recommendations.push('ì˜¨ë¼ì¸ ê°•ì˜ë‚˜ ë¶€íŠ¸ìº í”„ë¥¼ í†µí•œ ê¸°ì´ˆ ì—­ëŸ‰ ê°•í™”ë¥¼ ê¶Œì¥í•©ë‹ˆë‹¤.');
            } else if (personalScore < 3.0) {
                recommendations.push('ì‹¤ë¬´ í”„ë¡œì íŠ¸ ê²½í—˜ì„ ëŠ˜ë ¤ ì‹¤ì „ ì—­ëŸ‰ì„ í–¥ìƒì‹œí‚¤ì„¸ìš”.');
                recommendations.push('ì½”ë“œ ë¦¬ë·°ë‚˜ í˜ì–´ í”„ë¡œê·¸ë˜ë°ì„ í†µí•´ ì½”ë“œ í’ˆì§ˆì„ ê°œì„ í•˜ì„¸ìš”.');
            } else if (personalScore < 4.0) {
                recommendations.push('ê³ ê¸‰ ê¸°ìˆ  ìŠ¤íƒ í•™ìŠµê³¼ ì•„í‚¤í…ì²˜ ì„¤ê³„ ê²½í—˜ì„ ìŒ“ìœ¼ì„¸ìš”.');
                recommendations.push('íŒ€ ë‚´ì—ì„œ ê¸°ìˆ ì  ë¦¬ë”ì‹­ì„ ë°œíœ˜í•  ê¸°íšŒë¥¼ ì°¾ì•„ë³´ì„¸ìš”.');
            } else {
                recommendations.push('ì „ë¬¸ì„±ì„ ë°”íƒ•ìœ¼ë¡œ ì¡°ì§ ë‚´ ê¸°ìˆ  í‘œì¤€í™”ë¥¼ ì£¼ë„í•˜ì„¸ìš”.');
                recommendations.push('ì™¸ë¶€ ì»¤ë®¤ë‹ˆí‹°ë‚˜ ì˜¤í”ˆì†ŒìŠ¤ ê¸°ì—¬ë¥¼ í†µí•´ ì˜í–¥ë ¥ì„ í™•ì¥í•˜ì„¸ìš”.');
            }
            
            // ì¡°ì§ í‰ê· ê³¼ ë¹„êµí•œ ê¶Œì¥ì‚¬í•­
            if (comparison.organizationAverage) {
                const orgDiff = personalScore - comparison.organizationAverage.overall;
                if (orgDiff > 0.5) {
                    recommendations.push('ì¡°ì§ í‰ê· ë³´ë‹¤ ë†’ì€ ì—­ëŸ‰ì„ ë³´ìœ í•˜ê³  ìˆì–´ ë©˜í†  ì—­í• ì„ ê³ ë ¤í•´ë³´ì„¸ìš”.');
                } else if (orgDiff < -0.5) {
                    recommendations.push('ì¡°ì§ í‰ê·  ìˆ˜ì¤€ ë‹¬ì„±ì„ ìœ„í•œ ì²´ê³„ì ì¸ í•™ìŠµ ê³„íšì„ ìˆ˜ë¦½í•˜ì„¸ìš”.');
                }
            }
            
            // ì¹´í…Œê³ ë¦¬ë³„ ê¶Œì¥ì‚¬í•­
            for (const [category, data] of Object.entries(personalData.categoryScores)) {
                const categoryAvg = data.total / data.count;
                if (categoryAvg < 3.0) {
                    recommendations.push(`${category} ì˜ì—­ì˜ ê¸°ë³¸ê¸° ê°•í™”ê°€ í•„ìš”í•©ë‹ˆë‹¤.`);
                }
            }
            
            return `
                <div class="recommendations">
                    <h3>ğŸ’¡ ê°œì„  ê¶Œì¥ì‚¬í•­</h3>
                    <ul>
                        ${recommendations.map(rec => `<li>${rec}</li>`).join('')}
                    </ul>
                </div>
            `;
        }

        function copyShareUrl() {
            const shareUrl = document.getElementById('share-url').textContent;
            navigator.clipboard.writeText(shareUrl).then(() => {
                alert('ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
            }).catch(() => {
                // ë³µì‚¬ ì‹¤íŒ¨ ì‹œ ëŒ€ì²´ ë°©ë²•
                const textArea = document.createElement('textarea');
                textArea.value = shareUrl;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                alert('ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
            });
        }

        function restart() {
            selectedJob = '';
            responses = {};
            allQuestions = [];
            currentPage = 0;
            userInfo = {};
            responseId = '';
            
            // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
            document.getElementById('user-name').value = '';
            document.getElementById('user-department').value = '';
            document.getElementById('user-email').value = '';
            
            // ì§ë¬´ ì„ íƒ ì´ˆê¸°í™”
            document.querySelectorAll('.job-option').forEach(option => {
                option.classList.remove('selected');
            });
            
            // ë²„íŠ¼ ìƒíƒœ ì´ˆê¸°í™”
            updateStartButton();
            
            // URL íŒŒë¼ë¯¸í„° ì œê±°
            window.history.replaceState({}, document.title, window.location.pathname);
            
            // í™”ë©´ ì „í™˜
            document.getElementById('results').style.display = 'none';
            document.getElementById('assessment-form').style.display = 'none';
            document.getElementById('loading').style.display = 'none';
            document.getElementById('job-selection').style.display = 'block';
        }
    </script>
</body>

</html>
